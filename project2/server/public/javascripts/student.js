(()=>{const e=document.getElementById("name"),t=document.getElementById("firstname"),n=document.getElementById("number"),a=document.getElementById("create"),o=document.getElementById("clear"),d=document.getElementById("list"),r=document.getElementById("content");let c=[],s=null;const i=(e,t=!1)=>{const n=document.createElement("div");n.textContent=e,n.className=t?"error-message":"success-message",r.innerHTML="",r.appendChild(n),setTimeout((()=>{n.remove()}),3e3)},m=async()=>{try{const e=await fetch("/api/student");if(!e.ok)throw new Error("Erreur lors du chargement des étudiants");c=await e.json(),l()}catch(e){i(e.message,!0)}},l=()=>{if(d.innerHTML="",0===c.length)return void(d.innerHTML="<p>Aucun étudiant enregistré</p>");const e=document.createElement("table"),t=document.createElement("thead"),n=document.createElement("tr");["Numéro","Nom","Prénoms","Actions"].forEach((e=>{const t=document.createElement("th");t.textContent=e,n.appendChild(t)})),t.appendChild(n),e.appendChild(t);const a=document.createElement("tbody");c.forEach((e=>{const t=document.createElement("tr"),n=document.createElement("td");n.textContent=e.number,t.appendChild(n);const o=document.createElement("td");o.textContent=e.l_name,t.appendChild(o);const d=document.createElement("td");d.textContent=e.f_name,t.appendChild(d);const r=document.createElement("td"),c=document.createElement("button");c.textContent="Éditer",c.className="edit-button",c.onclick=()=>u(e);const s=document.createElement("button");s.textContent="Supprimer",s.className="delete-button",s.onclick=()=>p(e._id),r.appendChild(c),r.appendChild(s),t.appendChild(r),a.appendChild(t)})),e.appendChild(a),d.appendChild(e)},u=o=>{e.value=o.l_name,t.value=o.f_name,n.value=o.number,n.disabled=!0,s=o._id,a.textContent="Mettre à jour"},p=async e=>{if(confirm("Êtes-vous sûr de vouloir supprimer cet étudiant ?"))try{if(!(await fetch(`/api/student/${e}`,{method:"DELETE"})).ok)throw new Error("Erreur lors de la suppression");m(),i("Étudiant supprimé avec succès")}catch(e){i(e.message,!0)}},h=()=>{e.value="",t.value="",n.value="",n.disabled=!1,s=null,a.textContent="Créer"};a.addEventListener("click",(async()=>{const a=e.value.trim(),o=t.value.trim(),d=n.value.trim();if(a&&o&&d)try{let e;if(e=s?await fetch(`/api/student/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,firstname:o})}):await fetch("/api/student",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,firstname:o,number:d})}),!e.ok){const t=await e.json();throw new Error(t.error||"Erreur lors de l'enregistrement")}await e.json(),h(),m(),i(s?"Étudiant mis à jour avec succès":"Étudiant ajouté avec succès")}catch(e){i(e.message,!0)}else i("Tous les champs sont obligatoires",!0)})),o.addEventListener("click",h),document.addEventListener("DOMContentLoaded",m)})();