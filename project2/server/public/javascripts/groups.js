(()=>{const e=document.getElementById("groups-list"),t=document.getElementById("addGroups"),n=e.querySelectorAll("button");let o=null,r=[];const a=(e,n=!1)=>{const o=document.createElement("div");o.textContent=e,o.className=n?"error-message":"success-message",t.firstChild?t.insertBefore(o,t.firstChild):t.appendChild(o),setTimeout((()=>{o.remove()}),3e3)},d=async()=>{try{const e=await fetch("/api/groups/no-group");if(!e.ok)throw new Error("Erreur lors du chargement des étudiants sans groupe");r=await e.json(),s()}catch(e){a(e.message,!0)}},c=async e=>{try{const t=await fetch(`/api/groups/${e}`);if(!t.ok)throw new Error(`Erreur lors du chargement des étudiants du groupe ${e}`);r=await t.json(),u(e)}catch(e){a(e.message,!0)}},s=()=>{if(t.innerHTML="<h2>Étudiants sans groupe</h2>",0===r.length)return void(t.innerHTML+="<p>Tous les étudiants ont été assignés à un groupe</p>");const e=l();r.forEach((t=>{const n=document.createElement("tr"),o=document.createElement("td");o.textContent=t.number,n.appendChild(o);const r=document.createElement("td");r.textContent=t.l_name,n.appendChild(r);const a=document.createElement("td");a.textContent=t.f_name,n.appendChild(a);const d=document.createElement("td"),c=document.createElement("select");for(let e=1;e<=6;e++){const t=document.createElement("option");t.value=e,t.textContent=`Groupe ${e}`,c.appendChild(t)}const s=document.createElement("button");s.textContent="Assigner",s.className="assign-button",s.onclick=()=>i(t._id,c.value),d.appendChild(c),d.appendChild(s),n.appendChild(d),e.querySelector("tbody").appendChild(n)})),t.appendChild(e)},u=e=>{if(t.innerHTML=`<h2>Étudiants du groupe ${e}</h2>`,0===r.length)return void(t.innerHTML+="<p>Aucun étudiant dans ce groupe</p>");const n=l();r.forEach((e=>{const t=document.createElement("tr"),o=document.createElement("td");o.textContent=e.number,t.appendChild(o);const r=document.createElement("td");r.textContent=e.l_name,t.appendChild(r);const a=document.createElement("td");a.textContent=e.f_name,t.appendChild(a);const d=document.createElement("td"),c=document.createElement("button");c.textContent="Retirer du groupe",c.className="remove-button",c.onclick=()=>p(e._id),d.appendChild(c),t.appendChild(d),n.querySelector("tbody").appendChild(t)})),t.appendChild(n)},l=()=>{const e=document.createElement("table");e.className="student-table";const t=document.createElement("thead"),n=document.createElement("tr");["Numéro","Nom","Prénom","Actions"].forEach((e=>{const t=document.createElement("th");t.textContent=e,n.appendChild(t)})),t.appendChild(n),e.appendChild(t);const o=document.createElement("tbody");return e.appendChild(o),e},i=async(e,t)=>{try{const n=await fetch("/api/groups/assign",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:e,groupNumber:t})});if(!n.ok){const e=await n.json();throw new Error(e.error||"Erreur lors de l'assignation au groupe")}a(`Étudiant assigné au groupe ${t} avec succès`),d()}catch(e){a(e.message,!0)}},p=async e=>{try{const t=await fetch(`/api/groups/${e}`,{method:"DELETE"});if(!t.ok){const e=await t.json();throw new Error(e.error||"Erreur lors du retrait du groupe")}a("Étudiant retiré du groupe avec succès"),null===o?d():c(o)}catch(e){a(e.message,!0)}};document.addEventListener("DOMContentLoaded",(()=>{n.forEach(((e,t)=>{e.className="group-button",e.addEventListener("click",(()=>{var r;r=e,n.forEach((e=>{e.classList.remove("selected-button")})),r&&r.classList.add("selected-button"),0===t?(o=null,d()):(o=t,c(t))}))})),n[0].click()}))})();